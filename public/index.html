<!doctype html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TREC BioGen 2025 ‚Äî Task B</title>
  <style>
    /* ---------- THEME ---------- */
    :root{
      --bg:#0c0e17; --bg2:#0f1326; --panel:#121938; --card:#121938;
      --text:#e8ecff; --muted:#a9b4d6; --border:#223161;
      --accent:#7c3aed; --accent-2:#9f6bff; --accent-weak:#2c1f54;
      --chip:#101733; --chip-border:#2a3560;
      --link:#cbb7ff; --link-hover:#e3d8ff;
      --shadow:0 10px 30px rgba(0,0,0,.35);
      --badge:#2a3560;
    }
    [data-theme="light"]{
      --bg:#f6f7fb; --bg2:#ffffff; --panel:#ffffff; --card:#ffffff;
      --text:#0c1022; --muted:#4a5578; --border:#e3e6f1;
      --accent:#6a38e0; --accent-2:#5127cf; --accent-weak:#efe8ff;
      --chip:#f2f4ff; --chip-border:#dfe4ff;
      --link:#432aa6; --link-hover:#2a1d7a;
      --shadow:0 8px 20px rgba(12,16,34,.07);
      --badge:#eef0fb;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial;
      background:var(--bg); color:var(--text);
    }
    a{color:var(--link); text-decoration:underline}
    a:hover{color:var(--link-hover)}
    button{font:inherit}

    /* ---------- FIXED BACKGROUND ANIMATION (ALL PAGES) ---------- */
    #bg{
      position:fixed; inset:0; z-index:-1; overflow:hidden;
      background:
        radial-gradient(50% 60% at 15% 85%, rgba(124,58,237,.25) 0%, transparent 60%),
        radial-gradient(60% 70% at 85% 10%, rgba(84,36,196,.25) 0%, transparent 60%),
        radial-gradient(40% 50% at 60% 50%, rgba(33,29,85,.35) 0%, transparent 70%),
        linear-gradient(180deg, rgba(255,255,255,.03), transparent 40%);
      pointer-events:none;
    }
    /* vertical ‚Äúliquid‚Äù lines */
    #bg::before, #bg::after{
      content:""; position:absolute; inset:0; background:
        repeating-linear-gradient( to bottom,
          transparent 0 14px,
          rgba(124,58,237,.06) 14px 16px
        );
      animation:slide 18s linear infinite;
      mask: radial-gradient(1200px 100% at 50% 50%, #000 70%, transparent 100%);
      opacity:.4;
    }
    #bg::after{
      animation-duration:28s; opacity:.25;
      transform:scaleX(-1);
    }
    @keyframes slide { to { transform: translateY(-16px); } }

    /* ---------- HEADER ---------- */
    header{position:sticky; top:0; z-index:20; backdrop-filter:blur(8px);
      background:color-mix(in oklab, var(--bg) 86%, transparent);
      border-bottom:1px solid var(--border);
    }
    .nav{max-width:1100px;margin:0 auto;display:flex;gap:14px;align-items:center;padding:14px 18px}
    .brand{font-weight:700}
    .nav a{color:var(--muted); text-decoration:none; padding:6px 10px; border-radius:8px}
    .nav a:hover{background:color-mix(in oklab, var(--accent-weak) 18%, transparent)}
    .nav a.active{background:var(--badge); color:var(--text)}
    .spacer{flex:1}
    .toggle{width:24px; height:24px; display:inline-grid; place-items:center;
      border-radius:999px; border:1px solid var(--border); background:var(--panel); cursor:pointer}
    .toggle:hover{box-shadow:0 0 0 3px color-mix(in oklab, var(--accent) 24%, transparent)}

    /* ---------- LAYOUT ---------- */
    .container{max-width:1100px;margin:0 auto;padding:16px 18px 30px}
    .panel{background:var(--panel); border:1px solid var(--border); border-radius:16px; padding:18px; box-shadow:var(--shadow)}
    .card{background:var(--card); border:1px solid var(--border); border-radius:12px; padding:14px}
    .muted{color:var(--muted)}
    .hidden{display:none!important}

    /* ---------- HERO (HOME) ---------- */
    .hero{height:68vh; display:grid; place-items:center}
    .hero .content{text-align:center}
    .hero h1{font-size:40px; margin:0 0 10px}
    .hero p{margin:0 0 18px; color:var(--muted)}
    .btn{
      background:linear-gradient(90deg, var(--accent) , var(--accent-2));
      color:#fff; border:none; padding:10px 16px; border-radius:12px; cursor:pointer
    }
    .btn:hover{box-shadow:0 0 0 3px color-mix(in oklab, var(--accent) 24%, transparent)}
    .footer{max-width:1100px;margin:0 auto;padding:28px 18px;color:var(--muted);font-size:13px;text-align:center}
    .footer a{color:var(--link)}

    /* ---------- TASK PAGE ---------- */
    .task h2{margin:0 0 12px}
    .task .grid{display:grid; gap:14px}
    .badge{display:inline-block; padding:2px 8px; border-radius:999px; background:var(--badge); font-size:12px}

    /* ---------- VIEWER ---------- */
    .toolbar{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    .searchbar{position:relative; display:flex; gap:8px; width:100%}
    .searchbar input[type="text"]{flex:1; padding:12px 14px; border-radius:12px; border:1px solid var(--border); background:var(--bg2); color:var(--text)}
    .searchbar button{padding:10px 14px; border-radius:12px; border:1px solid var(--border); background:var(--bg2); color:var(--text); cursor:pointer}
    .filters{display:flex; gap:8px; flex-wrap:wrap; align-items:center}
    .chip{display:inline-flex; gap:8px; align-items:center; padding:8px 10px; border-radius:999px;
      border:1px solid var(--chip-border); background:var(--chip); color:var(--text)}
    .select{border:1px solid var(--border); background:var(--bg2); color:var(--text); border-radius:8px; padding:6px 8px}

    .qid{font-weight:700; font-size:12px; color:var(--muted)}
    .qt{font-size:18px; font-weight:800; margin:6px 0 4px}
    .topic{font-size:13px; color:var(--muted)}
    details{margin-top:8px} summary{cursor:pointer}

    .answers{margin-top:14px}
    .sys{font-weight:800; margin-bottom:10px; font-size:13px}
    .ans{line-height:1.65}
    .srow{margin:10px 0; padding:10px 12px; background:var(--bg2); border:1px solid var(--border); border-radius:10px}
    .srow .bullet{display:inline-block; width:8px; height:8px; border-radius:50%; background:var(--accent); margin-right:8px; transform:translateY(-1px)}
    .pmids{display:flex; gap:8px; flex-wrap:wrap; margin:8px 0 0}
    .pmid{background:var(--badge); border:1px solid var(--border); border-radius:999px; padding:2px 8px; font-size:12px}
    .pmid a{color:inherit; text-decoration:none}
    .pmid a:hover{text-decoration:underline}
    .sactions{display:inline-flex; gap:8px; margin-left:8px}
    .smallbtn{font-size:12px; padding:4px 8px; border-radius:999px; border:1px solid var(--border); background:var(--bg2); color:var(--text); cursor:pointer}
    .smallbtn:hover{background:color-mix(in oklab, var(--accent-weak) 24%, transparent)}

    .tabs{display:flex; gap:6px; flex-wrap:wrap; margin-bottom:10px}
    .tab{padding:6px 10px; border-radius:10px; border:1px solid var(--border); background:var(--bg2); cursor:pointer}
    .tab.active{background:color-mix(in oklab, var(--accent-weak) 40%, transparent); border-color:var(--accent)}
    .tabcontent{display:none}
    .tabcontent.active{display:block}

    .spinner-wrap{display:flex; gap:10px; align-items:center; justify-content:center; padding:24px}
    .spinner{width:16px; height:16px; border-radius:50%; border:3px solid color-mix(in oklab, var(--border) 70%, transparent); border-top-color:var(--accent); animation:spin .9s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}

    .abstract{margin-top:8px; padding:12px; border-radius:10px; background:var(--bg2); border:1px solid var(--border); color:var(--muted); white-space:pre-wrap}
    .result{border-top:1px solid var(--border); padding-top:16px; margin-top:16px}

    .subtle{background:var(--badge); border:1px solid var(--border)}
  </style>
</head>
<body>
  <div id="bg"></div>

  <header id="siteHeader">
    <div class="nav">
      <div class="brand">TREC BioGen 2025 ‚Äî Task B</div>
      <a href="#home" id="navHome" class="active">Home</a>
      <a href="#task" id="navTask">Task</a>
      <a href="#viewer" id="navViewer">Viewer</a>
      <div class="spacer"></div>
      <a href="https://github.com/cbsag/trec-biogen-taskb-viewer" target="_blank" rel="noopener">GitHub</a>
      <a href="https://www.linkedin.com/in/cbsag" target="_blank" rel="noopener">LinkedIn</a>
      <button class="toggle" id="themeToggle" title="Light / Dark">üåó</button>
    </div>
  </header>

  <!-- HOME -->
  <section id="home" class="container">
    <div class="hero panel subtle">
      <div class="content">
        <h1>TREC BioGen 2025 ‚Äî Task B</h1>
        <p>Generate answers for 30 medical questions and compare systems, with per-sentence PMIDs.</p>
        <button class="btn" id="openViewerBtn">Open Viewer</button>
      </div>
    </div>
  </section>

  <!-- TASK -->
  <section id="task" class="container hidden">
    <div class="panel task">
      <h2>Task Description (summary)</h2>
      <div class="grid">
        <div class="card">
          <div class="badge">Task A ‚Äî Grounding Answer</div>
          <ul>
            <li>For each given <em>answer sentence</em>, add up to <strong>3 new PMIDs</strong> that support it (prior PMIDs are provided) and up to <strong>3 PMIDs</strong> that contradict it.</li>
            <li>Use only the PMIDs from the released PubMed snapshot; contradicting evidence is preferred if both exist.</li>
            <li>Submission: JSONL, one object per QA pair, with each sentence‚Äôs <code>supported_citations</code> and <code>contradicted_citations</code>.</li>
          </ul>
        </div>
        <div class="card">
          <div class="badge">Task B ‚Äî Reference Attribution</div>
          <ul>
            <li>For each <em>topic</em>, generate an answer (‚â§ <strong>250 words</strong>). Each sentence may include up to <strong>3 PMIDs</strong> from the released PubMed snapshot that support it.</li>
            <li>Submission: JSONL, one object per topic with <code>responses</code> as sentence objects (each has <code>text</code> + <code>citations</code>).</li>
          </ul>
        </div>
        <div class="muted">
          Key dates (2025): Dataset &amp; baselines Jun 2 ¬∑ submissions Aug 15 ¬∑ results late Sep ¬∑ papers late Oct ¬∑ TREC Nov 17‚Äì21.
          <br />
          Official page: <a href="https://trec-biogen.github.io/docs/#task-description" target="_blank" rel="noopener">BioGen 2025 ‚Äî Task Description</a>
        </div>
      </div>
    </div>
  </section>

  <!-- VIEWER -->
  <section id="viewer" class="container hidden">
    <div class="panel">
      <div class="toolbar" style="margin-bottom:10px">
        <div class="searchbar">
          <input id="q" type="text" placeholder="Search by ID, question, topic, or narrative‚Ä¶ (e.g., ‚Äòaxonal injury‚Äô or ‚Äò181‚Äô)" />
          <button id="searchBtn">Search</button>
          <button id="toggleFilters" title="Show/Hide filters">‚öôÔ∏è Filters</button>
        </div>
      </div>

      <div id="filters" class="toolbar hidden" style="margin-bottom:10px">
        <div id="systems" class="filters"></div>
        <label class="muted">View</label>
        <select id="viewMode" class="select">
          <option value="auto" selected>Auto (Tabs if multiple)</option>
          <option value="tabs">Tabs</option>
          <option value="columns">Columns</option>
        </select>
        <label class="muted">Text size</label>
        <select id="textSize" class="select">
          <option value="1.55">Comfort</option>
          <option value="1.65" selected>Relaxed</option>
          <option value="1.8">Spacious</option>
        </select>
      </div>

      <div class="muted" id="meta" style="margin:6px 0 10px 0"></div>
      <div id="results"></div>
    </div>
  </section>

  <div class="footer">
    ~ cbsag ¬∑ <a href="https://github.com/cbsag" target="_blank" rel="noopener">GitHub</a> ¬∑
    <a href="https://www.linkedin.com/in/cbsag" target="_blank" rel="noopener">LinkedIn</a>
  </div>

  <script>
    /* ---------- NAV / SECTIONS ---------- */
    const sections = {
      home:   document.getElementById('home'),
      task:   document.getElementById('task'),
      viewer: document.getElementById('viewer'),
    };
    const header = document.getElementById('siteHeader');
    const navHome = document.getElementById('navHome');
    const navTask = document.getElementById('navTask');
    const navViewer = document.getElementById('navViewer');
    const themeToggle = document.getElementById('themeToggle');

    function setActiveNav(id){
      [navHome, navTask, navViewer].forEach(a => a.classList.remove('active'));
      if (id==='home') navHome.classList.add('active');
      if (id==='task') navTask.classList.add('active');
      if (id==='viewer') navViewer.classList.add('active');
    }
    function showSection(id){
      Object.entries(sections).forEach(([k,el]) => el.classList.toggle('hidden', k!==id));
      setActiveNav(id);
      window.location.hash = id;
      window.__interacted = true; // keep header visible
      header.classList.remove('hidden');
    }
    navHome.addEventListener('click', (e)=>{ e.preventDefault(); showSection('home'); });
    navTask.addEventListener('click', (e)=>{ e.preventDefault(); showSection('task'); });
    navViewer.addEventListener('click', (e)=>{ e.preventDefault(); showSection('viewer'); });

    document.getElementById('openViewerBtn').addEventListener('click', ()=> showSection('viewer'));

    // on load: route by hash, else Home
    window.addEventListener('DOMContentLoaded', ()=>{
      const h = (location.hash||'').replace('#','');
      showSection(h==='task' ? 'task' : h==='viewer' ? 'viewer' : 'home');
    });

    /* ---------- THEME ---------- */
    const root = document.documentElement;
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) root.setAttribute('data-theme', savedTheme);
    themeToggle.addEventListener('click', ()=>{
      const next = root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      root.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
    });

    /* ---------- VIEWER: DATA + UI ---------- */
    const systemsDiv = document.getElementById("systems");
    const resultsDiv = document.getElementById("results");
    const metaDiv = document.getElementById("meta");
    const qInput = document.getElementById("q");
    const searchBtn = document.getElementById("searchBtn");
    const textSizeSel = document.getElementById('textSize');
    const viewModeSel = document.getElementById('viewMode');
    const toggleFiltersBtn = document.getElementById('toggleFilters');
    const filtersBar = document.getElementById('filters');

    let allSystems = [];
    let sysDescriptions = {};
    let hasSearched = false;

    toggleFiltersBtn.addEventListener('click', ()=>{
      filtersBar.classList.toggle('hidden');
    });

    function selectedSystems() {
      return Array.from(document.querySelectorAll('.chip input[type="checkbox"]:checked')).map(cb => cb.value);
    }

    function renderSystems() {
      systemsDiv.innerHTML = "";
      allSystems.forEach(sys => {
        const chip = document.createElement("label");
        chip.className = "chip";
        const desc = (sysDescriptions[sys]||"").replace(/"/g,'&quot;');
        chip.innerHTML = `
          <input type="checkbox" value="${sys}" checked />
          <span>${sys}</span>
          <span class="muted" title="${desc}">‚ìò</span>
        `;
        systemsDiv.appendChild(chip);
      });
    }

    async function fetchSystems() {
      const r = await fetch("/api/systems");
      const data = await r.json();
      allSystems = data.systems || [];
      sysDescriptions = data.descriptions || {};
      renderSystems();
    }

    function splitSentences(text) {
      if (!text) return [];
      const parts = text.replace(/\s+/g, ' ').split(/(?<=[\.!?])\s+(?=[A-Z0-9])/g);
      return parts.filter(s => s && s.trim());
    }

    function pmidsForSentence(item, sys, sentenceIndex){
      // If your API includes per-sentence PMIDs, map them here.
      // Current behavior: show PMIDs stored per answer (collected across sentences).
      // This keeps your existing screenshots consistent.
      const list = (item.pmids && item.pmids[sys]) || [];
      return list.slice( sentenceIndex*3, sentenceIndex*3 + 3 ); // show a few per sentence if many
    }

    function renderPMIDList(container, pmids) {
      container.innerHTML = '<span class="muted">loading references‚Ä¶</span>';
      fetch(`/api/pubmed?pmids=${encodeURIComponent(pmids.join(","))}`)
        .then(r => r.json())
        .then(data => {
          if (data.error) { container.innerHTML = `<span class="muted">error: ${data.error}</span>`; return; }
          if (!data.items || !data.items.length) { container.innerHTML = '<span class="muted">no details returned</span>'; return; }
          const frag = document.createDocumentFragment();
          data.items.forEach(p => {
            const li = document.createElement('div'); li.className='card'; li.style.margin='10px 0';
            const link = document.createElement('a'); link.href = p.url; link.target='_blank'; link.rel='noopener';
            link.textContent = `${p.title} (${p.journal}${p.year ? ', ' + p.year : ''})`;
            li.appendChild(link);
            if (p.doi) { const d = document.createElement('div'); d.className='muted'; d.textContent = `doi: ${p.doi}`; li.appendChild(d); }
            if (p.abstract) { const abs = document.createElement('div'); abs.className='abstract'; abs.textContent = p.abstract; li.appendChild(abs); }
            frag.appendChild(li);
          });
          container.innerHTML = ''; container.appendChild(frag);
        })
        .catch(err => { container.innerHTML = `<span class="muted">error: ${String(err.message || err)}</span>`; });
    }

    function populateSentences(ansDiv, text, item, sys) {
      ansDiv.style.lineHeight = textSizeSel.value;
      if (!text) { ansDiv.innerHTML = "<span class='muted'>‚Äî no answer ‚Äî</span>"; return; }

      const sents = splitSentences(text);
      sents.forEach((s, idx) => {
        const row = document.createElement('div'); row.className = 'srow';
        const dot = document.createElement('span'); dot.className = 'bullet';
        const span = document.createElement('span'); span.className = 'text'; span.textContent = s;

        // PMIDs (chips)
        const pmids = pmidsForSentence(item, sys, idx);
        const pmidWrap = document.createElement('div'); pmidWrap.className = 'pmids';
        if (pmids.length) {
          pmids.forEach(id => {
            const chip = document.createElement('span'); chip.className='pmid';
            chip.innerHTML = `<a href="https://pubmed.ncbi.nlm.nih.gov/${id}/" target="_blank" rel="noopener">${id}</a>`;
            pmidWrap.appendChild(chip);
          });
        } else {
          const none = document.createElement('span'); none.className='pmid muted'; none.textContent='no PubMed matches';
          pmidWrap.appendChild(none);
        }

        // ‚ÄúShow refs‚Äù pulls full titles + abstracts for THIS sentence‚Äôs pmids
        const actions = document.createElement('span'); actions.className='sactions';
        const btn = document.createElement('button'); btn.className='smallbtn'; btn.textContent='Show refs';
        const slot = document.createElement('div'); slot.className='muted'; slot.style.marginTop='8px';

        btn.addEventListener('click', ()=>{
          if (!pmids.length){ slot.innerHTML = '<span class="muted">no PMIDs for this sentence</span>'; return; }
          renderPMIDList(slot, pmids);
        });

        actions.appendChild(btn);
        row.appendChild(dot); row.appendChild(span);
        row.appendChild(pmidWrap); row.appendChild(actions); row.appendChild(slot);
        ansDiv.appendChild(row);
      });
    }

    function renderResults(data) {
      resultsDiv.innerHTML = "";
      if (!hasSearched){
        metaDiv.textContent = "Use the search bar above to get started.";
        return;
      }
      metaDiv.textContent = `${data.count} result(s) ‚Ä¢ showing: ${data.systems.join(", ")}`;

      data.results.forEach(item => {
        const wrap = document.createElement("div");
        wrap.className = "panel result";

        // header
        const header = document.createElement("div");
        header.innerHTML = `
          <div class="qid">ID ${item.id}</div>
          <div class="qt">${item.question}</div>
          <div class="topic">Topic: ${item.topic || "‚Äî"}</div>
        `;
        wrap.appendChild(header);

        // narrative
        const det = document.createElement("details");
        const sum = document.createElement("summary");
        sum.textContent = "Show narrative";
        det.appendChild(sum);
        const p = document.createElement("div");
        p.className = "muted";
        p.style.marginTop = "8px";
        p.textContent = item.narrative || "‚Äî";
        det.appendChild(p);
        wrap.appendChild(det);

        // answers area
        const answersWrap = document.createElement("div");
        answersWrap.className = "answers";

        const sysList = Object.entries(item.answers).filter(([, text]) => text && text.trim());
        const multi = sysList.length > 1;
        const mode = viewModeSel.value === 'auto' ? (multi ? 'tabs' : 'single') : viewModeSel.value;

        if (!multi || mode === 'single') {
          const [sys, text] = sysList[0] || Object.entries(item.answers)[0] || ["System", ""];
          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `<div class="sys">${sys}</div><div class="ans"></div>`;
          answersWrap.appendChild(card);
          populateSentences(card.querySelector('.ans'), text, item, sys);

        } else if (mode === 'tabs') {
          const tabs = document.createElement('div'); tabs.className = 'tabs';
          const contents = document.createElement('div');

          sysList.forEach(([sys, text], idx) => {
            const t = document.createElement('button');
            t.className = 'tab' + (idx === 0 ? ' active' : '');
            t.textContent = sys;
            tabs.appendChild(t);

            const c = document.createElement('div');
            c.className = 'tabcontent' + (idx === 0 ? ' active' : '');
            const card = document.createElement('div'); card.className = 'card';
            card.innerHTML = `<div class="sys">${sys}</div><div class="ans"></div>`;
            c.appendChild(card);
            contents.appendChild(c);

            populateSentences(card.querySelector('.ans'), text, item, sys);

            t.addEventListener('click', () => {
              tabs.querySelectorAll('.tab').forEach(x => x.classList.remove('active'));
              contents.querySelectorAll('.tabcontent').forEach(x => x.classList.remove('active'));
              t.classList.add('active'); c.classList.add('active');
            });
          });

          answersWrap.appendChild(tabs);
          answersWrap.appendChild(contents);

        } else {
          const grid = document.createElement('div');
          grid.style.display = 'grid';
          grid.style.gridTemplateColumns = `repeat(${Math.min(sysList.length, 3)}, minmax(320px, 1fr))`;
          grid.style.gap = '16px';

          sysList.forEach(([sys, text]) => {
            const card = document.createElement('div'); card.className = 'card';
            card.innerHTML = `<div class="sys">${sys}</div><div class="ans"></div>`;
            grid.appendChild(card);
            populateSentences(card.querySelector('.ans'), text, item, sys);
          });

          answersWrap.appendChild(grid);
        }

        wrap.appendChild(answersWrap);
        resultsDiv.appendChild(wrap);
      });
    }

    async function doSearch() {
      hasSearched = true;
      resultsDiv.innerHTML = `<div class="spinner-wrap"><div class="spinner"></div><div class="muted">Loading‚Ä¶</div></div>`;
      const q = qInput.value;
      const selected = selectedSystems();
      const url = `/api/search?q=${encodeURIComponent(q)}&systems=${encodeURIComponent(selected.join(","))}`;
      const r = await fetch(url);
      const data = await r.json();
      renderResults(data);
    }

    // Search triggers only on button click or Enter (no live typing fetch)
    searchBtn.addEventListener('click', doSearch);
    qInput.addEventListener('keydown', (e)=>{ if (e.key==='Enter') doSearch(); });

    // text size live
    textSizeSel.addEventListener('change', ()=>{
      document.querySelectorAll('.ans').forEach(a => a.style.lineHeight = textSizeSel.value);
    });

    // init systems
    (async function init() {
      await fetchSystems();
      // do NOT auto-search; wait until user hits Search
      // keep filters hidden until user opens them
    })();

    // Ensure header visible when clicking any nav (prevents ‚Äústuck‚Äù state)
    [navHome, navTask, navViewer].forEach(a=>{
      a.addEventListener('click', ()=>{
        window.__interacted = true;
        header.classList.remove('hidden');
      });
    });
  </script>
</body>
</html>
